## 从输入URL到页面展示，这中间发生了什么？

整个过程需要各个进程的配合
1. 浏览器进程负责用户交互、子进程管理和文件存储
2. 网络进程面向渲染进程和浏览器进程提供下载功能
3. 渲染进程负责把HHTML、JS、CSS图片等资源解析为可以显示和交互的页面。

大致过程如下：
1. 首先，用户从浏览器进程里`输入请求信息`
2. 然后，网络进程`发起URL请求`
3. 服务器响应URL请求后，浏览器进程开始`准备渲染进程`了
4. 渲染进程准备好之后，需要先向渲染进程提交页面数据，我们称之为`提交文档阶段`；
5. 渲染进程接受完文档信息之后，便开始`解析页面和加载子资源`，完成页面的渲染。

`用户发出URL请求到页面开始解析的这个过程，就叫做导航。`

## 从输入URL到页面展示

1. 用户输入
   当用户在地址栏中输入一个查询关键字时，地址栏会判断输入的关键字是`搜索内容`还是`请求的URL`
    - 如果是搜索内容，地址栏会使用浏览器默认的搜索引擎，来合成新的带搜索关键字的URL
    - 如果判断内容符合URL过真，那么地址栏会根据规则，把这段内容加上协议，合称为完整的URL。

2. URL请求过程
   浏览器进程会通过IPC(进程间通信)把URL请求发送至网络进程，网络进程接收到URL请求之后，会在这里发起真正的URL请求流程。
- 首先，网络进程会查找本地缓存是否缓存了该资源。如果有缓存资源，那么直接返回给浏览器进程；果在缓存中没有查找到资源，那么直接进入网络请求流程。这请求前的第一步是要进行 DNS 解析，以获取请求域名的服务器 IP 地址。如果请求协议是 HTTPS，那么还需要建立 TLS 连接。

- 接下来就是利用 IP 地址和服务器建立 TCP 连接。连接建立之后，浏览器端会构建请求行、请求头等信息，并把和该域名相关的 Cookie 等数据附加到请求头中，然后向服务器发送构建的请求信息。

- 服务器接收到请求信息后，会根据请求信息生成响应数据（包括响应行、响应头和响应体等信息），并发给网络进程。等网络进程接收了响应行和响应头之后，就开始解析响应头的内容了。（为了方便讲述，下面我将服务器返回的响应头和响应行统称为响应头。）

（1）重定向
在接收到服务器返回的响应头后，网络进程开始解析响应头，如果发现返回的状态码是 301 或者 302，那么说明服务器需要浏览器重定向到其他 URL。这时网络进程会从响应头的 Location 字段里面读取重定向的地址，然后再发起新的 HTTP 或者 HTTPS 请求，一切又重头开始了。

3. 准备渲染进程
默认情况下，Chrome 会为每个页面分配一个渲染进程。在某些情况下，浏览器会让多个页面直接运行在同一个渲染进程中。

那什么情况下多个页面会同时运行在一个渲染进程中呢？
“同一站点”定义为根域名（例如，geekbang.org）加上协议（例如，https:// 或者 http://），还包含了该根域名下的所有子域名和不同的端口

4. 提交文档(“文档”是指 URL 请求的响应体数据。)
- “提交文档”的消息是由浏览器进程发出的，渲染进程接收到“提交文档”的消息后，会和网络进程建立传输数据的“管道”。
- 等文档数据传输完成之后，渲染进程会返回“确认提交”的消息给浏览器进程。
- 浏览器进程在收到“确认提交”的消息后，会更新浏览器界面状态，包括了安全状态、地址栏的 URL、前进后退的历史状态，并更新 Web 页面。

5. 渲染阶段
一旦文档被提交，渲染进程便开始页面解析和子资源加载了